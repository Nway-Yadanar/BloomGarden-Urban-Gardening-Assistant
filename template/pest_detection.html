<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pest Detection</title>
    <link rel="stylesheet" href="static/gardening.css">
</head>
<body>
   <main class="cbt">
    <!-- top bar -->
    <header class="cbt__topbar">
      <!-- top-left hamburger -->
      <button class="cbt__iconbtn" id="cbtMenuBtn" aria-label="toggle sidebar" title="Menu">â˜°</button>

      <!-- brand centered-ish, flexible spacing either side -->
       <div class="cbt__brand">
        <span class="cbt__brandLogo" aria-hidden="true">ğŸ’¬</span>
        <span class="cbt__brandSub">Â°â€â‹†.à³ƒà¿”*:ï½¥Â°â€â‹†.à³ƒà¿”*:ï½¥</span>
        <strong  style="text-align: center;">Bloom Garden</strong> 
        <span class="cbt__brandSub">Â°â€â‹†.à³ƒà¿”*:ï½¥Â°â€â‹†.à³ƒà¿”*:ï½¥</span>
      </div>

      <div class="cbt__topbarRight">
        
        <button id="cbtThemeToggle" class="cbt__chip" aria-pressed="false" title="Toggle theme">ğŸŒ“ theme</button>
      </div>
    </header>

    <!-- sidebar (routes) -->
    <aside id="cbtSidebar" class="cbt__sidebar" aria-label="sidebar navigation">
      <nav>
        <a href="chatbot.html" data-route="chat" class="active">ğŸ’¬ Chatbot</a>
        <a href="pest_detection.html" class="active">ğŸª² Pest Detection</a>  
        <a href="plantfaq.html" data-route="plantfaq" class="active">ğŸª´ plant FAQ</a>
        <a href="notice.html" data-route="moon" class="active">â˜¾ğ–¤“ Celestial Garden</a>
        <a href="tasks.html" class="active">ğŸ“‹ Daily Tasks</a>
        <a href="stickers.html" class="active">ğŸ€ Stickers</a>
      </nav>
    
    </aside>

    <div class="pest-container">
  <!-- Upload Card -->
  <div class="glass-card pest-card">
    <h3>Upload Plant Photo</h3>
    <div class="upload-box" id="uploadBox">
      <p>ğŸŒ¿ Drag & drop your plant photo here<br>
        or <span class="browse">click to browse files</span>
      </p>
      <p class="formats">Supported formats: JPG, PNG, GIF, WebP</p>
      <input type="file" id="fileInput" accept="image/*" hidden>
    </div>
    <div class="button-row">
      <button id="analyzeBtn" disabled>ğŸ” Detect Pests</button>
      <button id="resetBtn">â™»ï¸ Select New Image</button>
    </div>
  </div>

  <!-- Results Card -->
  <div class="glass-card pest-card">
    <h3>Pest Detection Results</h3>
    <div id="results" class="results">
      <p>Upload a clear photo of your plant leaves. Our AI will detect pests, highlight affected areas, and provide treatment recommendations.</p>
    </div>
  </div>
</div>

</body>
<script src="/static/js/main.js"></script>
<script>
const uploadBox = document.getElementById("uploadBox");
const fileInput = document.getElementById("fileInput");
const analyzeBtn = document.getElementById("analyzeBtn");
const resetBtn = document.getElementById("resetBtn");
const results = document.getElementById("results");

let selectedFile = null;

// click or drag & drop
uploadBox.addEventListener("click", () => fileInput.click());
fileInput.addEventListener("change", e => {
  selectedFile = e.target.files[0];
  if (selectedFile) {
    uploadBox.innerHTML = `<p>ğŸ“¸ ${selectedFile.name}</p>`;
    analyzeBtn.disabled = false;
  }
});

// drag-drop
uploadBox.addEventListener("dragover", e => e.preventDefault());
uploadBox.addEventListener("drop", e => {
  e.preventDefault();
  selectedFile = e.dataTransfer.files[0];
  if (selectedFile) {
    uploadBox.innerHTML = `<p>ğŸ“¸ ${selectedFile.name}</p>`;
    analyzeBtn.disabled = false;
  }
});

// send to /pest-detect
analyzeBtn.addEventListener("click", async () => {
  if (!selectedFile) return;

  const formData = new FormData();
  formData.append("file", selectedFile);

  results.innerHTML = "ğŸ” Analyzing...";
  analyzeBtn.disabled = true;

  const res = await fetch("/pest-detect", {
    method: "POST",
    body: formData
  });

  const data = await res.json();
  if (data.error) {
    results.innerHTML = `<p style="color:red;">âŒ ${data.error}</p>`;
  } else {
    results.innerHTML = `
      <h4>âœ… Detected: ${data.pests.join(", ")}</h4>
      <ul>${data.recommendations.map(r => `<li>${r}</li>`).join("")}</ul>
    `;
  }
  analyzeBtn.disabled = false;
});

resetBtn.addEventListener("click", () => {
  selectedFile = null;
  fileInput.value = "";
  uploadBox.innerHTML = `<p>ğŸŒ¿ Drag & drop your plant photo here<br>or <span class="browse">click to browse files</span></p>`;
  results.innerHTML = `<p>Upload a clear photo of your plant leaves. Our AI will detect pests, highlight affected areas, and provide treatment recommendations.</p>`;
  analyzeBtn.disabled = true;
});
</script>

</html>