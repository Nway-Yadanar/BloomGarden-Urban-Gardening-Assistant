<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lunar Plant Recommender 🌙</title>
  <link rel="stylesheet" href="gardening.css">
  <style>

    @media(max-width: 600px) {
      .container {
        padding: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <header>
  
  <!-- Hamburger Icon -->
  <div class="hamburger" onclick="toggleSidebar()">
    <img src="/images/cleanlogo.png" alt="BloomGarden Logo" class="logo">☰</div>
</header>
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <nav>
      <a href="index.html">🏠 Home</a>
      <a href="plantfaq.html">🌿 Plant FAQ</a>
 
      <a href="game.html">🌱 Growth Game</a>
      <a href="journal.html">📔 Plant Journal</a>
      <a href="moon.html">🌕 Lunar Recommender</a>
    </nav>
  </div>
   <div class="glass-card">
  <div class="card-header">
    <span class="moon-emoji">🌕</span>
    <h1>Lunar Plant Recommender</h1>
  </div>
  <div class="today-moon">
  <h3>Today's Moon Phase</h3>
  <div class="moon-phase-container">
    
    <div class="moon-progress">
      <div class="progress-bar" id=moonBar"></div>
    </div>
    <div class="moon-text" id="moonText">Loading...</div>
  </div>
</div>



  <div class="form-group">
    <label for="date">Select Date</label>
    <input type="date" id="date">
  </div>

  <div class="form-group">
    <label for="plantType">Choose Plant Type</label>
    <select id="plantType">
      <option value="Edible">Edible</option>
      <option value="Inedible">Inedible</option>
    </select>
  </div>

  <button onclick="recommendPlants()">Get Recommendations</button>

  <div id="phaseOutput" class="lunar-phase">🌙 Moon Phase</div>
  <div id="suggestionOutput" class="results">🪴 Suggested plants will appear here.</div>
</div>


  <script>
    async function loadPlants() {
      const response = await fetch('../data/indoor_plants.json');
      return response.json();
    }

    function getMoonPhase(date) {
      const day = date.getDate();
      const cycleDay = day % 29.53; // simplified lunar cycle
      if (cycleDay < 1) return "New Moon";
      if (cycleDay < 7) return "Waxing Crescent";
      if (cycleDay < 10) return "First Quarter";
      if (cycleDay < 14) return "Waxing Gibbous";
      if (cycleDay < 16) return "Full Moon";
      if (cycleDay < 22) return "Waning Gibbous";
      if (cycleDay < 25) return "Last Quarter";
      return "Waning Crescent";
    }

    async function recommendPlants() {
      const dateInput = document.getElementById('date').value;
      const type = document.getElementById('plantType').value;
      if (!dateInput) {
        alert("Please select a date!");
        return;
      }

      const date = new Date(dateInput);
      const phase = getMoonPhase(date);
      document.getElementById('phaseOutput').innerText = `🌙 ${phase}`;

      const plants = await loadPlants();
      const edibleOnly = type === "Edible";
      let suggestions = plants.filter(p => {
        if (edibleOnly && !p.edible) return false;
        if (!edibleOnly && p.edible) return false;
        return p.moon_phase && p.moon_phase.growing === phase;
      }).map(p => p.plant);

      const suggestionBox = document.getElementById('suggestionOutput');
      if (suggestions.length === 0) {
        suggestionBox.innerHTML = "No suitable plants today. 🌱 Focus on care tasks.";
      } else {
        suggestionBox.innerHTML = "🪴 Suggested Plants:<ul>" + suggestions.map(s => `<li>${s}</li>`).join("") + "</ul>";
      }
    }

    async function showTodayMoonPhase() {
  fetch("http://127.0.0.1:5000/moon")
  .then(res => res.json())
  .then(data => {
    const { phase, illumination } = data;
    document.getElementById("moonBar").style.width = illumination + "%";
    document.getElementById("moonText").innerText = `🌙 ${illumination}% - ${phase}`;
  });

}

// Emoji mapping (same as before)
function getMoonEmoji(phase) {
  switch(phase) {
    case "New Moon": return "🌑";
    case "Waxing Crescent": return "🌒";
    case "First Quarter": return "🌓";
    case "Waxing Gibbous": return "🌔";
    case "Full Moon": return "🌕";
    case "Waning Gibbous": return "🌖";
    case "Last Quarter": return "🌗";
    case "Waning Crescent": return "🌘";
    default: return "🌙";
  }
}

// Call on page load
showTodayMoonPhase();
async function showTodayMoonPhase() {
  try {
    const res = await fetch("/moon");
    const data = await res.json();

    const { phase, illumination } = data;

    document.getElementById("todayMoonBar").style.width = illumination + "%";
    document.getElementById("todayMoonText").innerText =
      `${getMoonEmoji(phase)} ${illumination}% - ${phase}`;
  } catch (err) {
    console.error("Error fetching moon phase:", err);
    document.getElementById("todayMoonText").innerText =
      "⚠️ Could not load moon data";
  }
}

// Call on page load
showTodayMoonPhase();



// Emoji mapping (same as before)
function getMoonEmoji(phase) {
  switch(phase) {
    case "New Moon": return "🌑";
    case "Waxing Crescent": return "🌒";
    case "First Quarter": return "🌓";
    case "Waxing Gibbous": return "🌔";
    case "Full Moon": return "🌕";
    case "Waning Gibbous": return "🌖";
    case "Last Quarter": return "🌗";
    case "Waning Crescent": return "🌘";
    default: return "🌙";
  }
}

// Call on page load
showTodayMoonPhase();


     const sidebar = document.getElementById('sidebar');
const hamburger = document.querySelector('.hamburger');

hamburger.addEventListener('click', () => {
  sidebar.classList.toggle('open');
});
  </script>
</body>
<!-- <img src="/images/plant.png" alt="Plant" class="plant-icon"> -->
</html>
